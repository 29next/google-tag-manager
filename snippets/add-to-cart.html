{% if app.settings.google_tag_manager_enabled %}
<script>
    dataLayer.push({ ecommerce: null });
    dataLayer.push({
        event: 'add_to_cart',
        ecommerce: {
            currency: '{{ line.price_currency }}',
            value: {{ line.unit_price_incl_tax_incl_discount | escapejs }},
            items: [
                {
                    index: 0,
                    item_id: '{{ line.product_id|escapejs }}',
                    item_name: '{{ line.product.title|escapejs }}',
                    item_category: '{{ product.categories.first.name|safe }}',
                    price: '{{ line.unit_price_incl_tax_incl_discount|escapejs }}',
                    quantity: {{ line.quantity }}
                }
            ]
        }
    });
</script>
{% endif %}
